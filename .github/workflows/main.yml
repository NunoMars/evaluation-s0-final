name: Deploy the app in LXD containers

on:
  push:
    branches:
      - main
  
jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

   
    - name: Save Firewall Rules
      run: |
        # Create the directory if it doesn't exist
        echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S lxc exec firewall-container -- mkdir -p /etc/iptables
    
        # Check if the directory exists
        echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S lxc exec firewall-container -- test -d /etc/iptables && \
        
        # Save the firewall rules so they persist after reboot
        echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S lxc exec firewall-container -- iptables -S -nave > /etc/iptables/rules.v4
      
      

name: Deploy the app in LXD containers

on:
  push:
    branches:
      - main
  
jobs:
  deploy:
    runs-on: self-hosted

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
   
    - name: Save Firewall Rules
      run: |
        # Check if the directory exists, create it if needed
        echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S lxc exec firewall-container -- mkdir -p /etc/iptables
    
        # Save the firewall rules so they persist after reboot
        echo "${{ secrets.SUDO_PASSWORD }}" | sudo -S lxc exec firewall-container -- iptables-save > /etc/iptables/rules.v4
    
